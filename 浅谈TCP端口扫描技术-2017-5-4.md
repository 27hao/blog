---
title: 浅谈TCP端口扫描技术
categories: 网络技术
date: 2017-05-04 10:09:43
---
## 端口扫描描述 ##
在一般的网络攻击或者说渗透测试中，首要任务也是最重要的任务就是踩点，也就是对目标系统信息的收集，而端口扫描就是踩点中最重要的一项。
端口扫描不仅用于踩点，并且经常用于批量抓取肉鸡，就是在扫描到端口开放后就用弱口令尝试登录系统，最后将这些肉鸡用于 ddos 等其它领域。互联网中常用的端口有 ftp 服务端口 21 ，ssh 服务端口 22 ，TELNET 远程登录服务 23 ，DNS 服务端口 53 ，http 服务端口 80，windous 远程桌面服务 3389 端口，SQL Server 服务端口 1433 ，mysql 端口 3306 。
在网络中，你的系统开放了几个端口，也就意味着你为别人开了几扇门,所以网络攻击是离不开端口的，黑客利用这些开放的端口就能进入你的系统，所以一个系统开放越少的端口就越安全。
我们在计算机网络课程中都学过，端口这个概念来自于OSI模型中的传输层，用于系统中各个应用程序与外界交流。而传输层有TCP和UDP协议，所以端口也就分为TCP端口和UDP端口，现在我着重讲解的是TCP端口扫描。
## TCP 端口扫描技术 ##
TCP 端口扫描技术的基础是 TCP 协议中的三次握手以及四次挥手，这里面就涉及了 TCP 首头中的几个控制位，URG，ACK，PSH，
RST，SYN，FIN。
一次完整的 TCP 连接的步骤：
1. 客户端发起连接将数据报中将 TCP 首头的 SYN 控制位置为 1，表明这是一个连接请求 。
2. 服务端接受到连接请求，如果这个端口是开放的，就将回复的数据报 TCP 首头中 SYN 置为1，ACK 位也置位 1，表明接受请求并且也请求连接。如果这个端口没有开放，就将 RST 位置为1，表明这个连接失败。
3. 客户端接受到服务器的回复，如果 SYN 和 ACK 位为1，就将 RST 位和 ACK 位置为 1 ，表明接受请求并且连接完毕。如果 RST 位为1，说明连接失败。

而每种 TCP 端口扫描技术都是在这上面动手脚。
### TCP 全连接 ###
全 TCP 连接是 TCP 端口扫描的基础。它是我们最熟悉的，我们经常写的网络程序都会用到，它的原理很简单，就是一个普通的完整的 sockt 连接，也就是完整的三次握手和四次挥手。如果连接成功就说明这个端口是开放的，反之则是关闭的。虽然这种扫描技术简单且容易实现并且无需任何特殊权限，但是这种扫描容易被检测出来并且很慢，所以很不安全，用的很少。

### SYN 扫描 ###
SYN 扫描也被称为半开放扫描，它和 TCP 全连接差不多，只是如果端口开放，在第三次握手的时候只将 RST 位置为 1 。直接就将连接断开了，这样就可以绕开很多防火墙，检测出来的几率大大减小，就安全很多并且比较准确，所以这种方式用的比较多。

### FIN 扫描 ###
FIN 扫描是一种隐藏连接扫描，它和前两种有比较大的区别，因为前两种都是在建立连接是操作的，而这种扫描方式是基于断开连接的。它将 TCP 首头中 FIN 控制位置为 1 ，请求与服务器断开连接，如果服务器上这个端口关闭时，服务器会返回一个报文，并且 RST 位置为 1 。如果这个端口开放，因为并没有建立连接，何谈断开连接，所以服务器不会返回任何报文。而如果服务器返回一个 IMCP 报文，则表示这个报文被防火墙过滤了，所以这种方式很准确且速度比前两种快得多。

## 常见的端口扫描器 ##
* Nmap:Nmap 是一款用于网络发现和安全审计的网络安全工具，支持十几种端口扫描技术，当然它不仅用于端口扫描，它的功能很强大，基本是网络攻击的必备工具。
* Zmap:Zmap 是一款号称一个小时扫完全网的端口扫描器，它采用的是一种加强的 SYN 扫描技术。
